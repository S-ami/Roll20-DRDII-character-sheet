<div>
    <button type="action" name="act_character" >Postava</button>
    <button type="action" name="act_special-abilities" >Schopnosti</button>
    <button type="action" name="act_texts" >Spisy</button>
    <button type="action" name="act_companions" >Pomocníci</button>
</div>
<input type='hidden' class='tabstoggle' name='attr_sheetTab' value='character' />
<div class="character">
    <div>
        <h1>Deník postavy</h1>
    </div>
    <div class="two-col character-basics flex-column">
        <div class="basics-child flex-row"><label>Jméno:&nbsp;</label><input type="text" name="attr_charname" /></div>
        <div class="basics-child flex-row"><label>Rasová zvláštní schopnost:&nbsp;</label><input type="text" name="attr_race_ability" /></div>
        <div class="basics-child flex-row"><label>Povahový rys:&nbsp;</label><input type="text" name="attr_personality_trait" /></div>
    </div>
    <div>
        <div class="threat-benefit">
            <label>Ohrožení:&nbsp;</label>
            <input type="number" name="attr_threat" />
            <label>Výhoda:&nbsp;</label>
            <input type="number" name="attr_benefit" />
        </div>
        <div class="resources">
            <div class="two-col">
                <h3>Zdatnosti</h3>
                <table>
                    <thead>
                        <tr>
                            <td></td>
                            <td>Nyní</td>
                            <td>Zjizvené</td>
                            <td>Maximum</td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Tělo</td>
                            <td><input type="number" name="attr_resource-body"/></td>
                            <td><input type="number" name="attr_resource-body-scars"/></td>
                            <td><input type="number" name="attr_resource-body_max"/></td>
                        </tr>
                        <tr>
                            <td>Duše</td>
                            <td><input type="number" name="attr_resource-spirit"/></td>
                            <td><input type="number" name="attr_resource-spirit-scars"/></td>
                            <td><input type="number" name="attr_resource-spirit_max"/></td>
                        </tr>
                        <tr>
                            <td>Vliv</td>
                            <td><input type="number" name="attr_resource-influence"/></td>
                            <td><input type="number" name="attr_resource-influence-scars"/></td>
                            <td><input type="number" name="attr_resource-influence_max"/></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="scars">
            <div>
                <h3>Jizva</h3>
            </div>
            <div>
                <h3>Úroveň</h3>
            </div>
            <div class="two-col">
                <fieldset class="repeating_scars">
                    <div>
                        <input type="text" name="attr_scarname"/>
                    </div>
                    <div>
                        <input type="number" name="attr_scartier"/>
                    </div>
                </fieldset>
            </div>
        </div>
    </div>
    <div>
        <div class="race-proffesion">
            <div class="two-col">
                <h3>Rasa (kultura)</h3>
            </div>
            <div class="two-col" style="margin-bottom: 15px">
                <input type="text" name="attr_source_race" class="full-width" />
            </div>
            <div>
                <h3>Povolání</h3>
            </div>
            <div>
                <h3>Úroveň</h3>
            </div>
        </div>
        <div>
            <fieldset class="repeating_proffesions">
                <div>
                    <input type="text" name="attr_proffesionname"/>
                    <button name="roll_proffesion" type="roll" value="&{template:default}{{name=Hod na povolání}}{{@{proffesionname}=[[?{Typ|Standard, 2d6|Přesně, 3d6kh2|Nepřesně, 3d6kl2}+@{proffesionlevel}]]}}"></button>
                </div>
                <div>
                    <input type="number" name="attr_proffesionlevel"/>
                </div>
            </fieldset>
        </div>
    </div>
    <div>
        <h3>Vybavení</h3>
        <textarea name="attr_equipment"></textarea>
        <label>Naložení:&nbsp;<button type="action" class="custom-butt" name="act_load"><span name='attr_load'></span></button></label>
    </div>
    <div>
        <h3>Zbraně a zbroje</h3>
        <textarea name="attr_weapons_and_armour"></textarea>
    </div>
<!--    <div class="two-col state-info">-->
        <div class="flex-row">
            <span class="custom-label width-100px">Suroviny:</span><input type="text" name="attr_materials" />
        </div>
        <div class="currency">
            <div class="flex-row">
                <span class="custom-label">Dukáty:</span><input type="text" name="attr_dukaty" />
            </div>
            <div class="flex-row">
                <span class="custom-label">Groše:</span><input type="text" name="attr_grose" />
            </div>
            <div class="flex-row">
                <span class="custom-label">Haléře:</span><input type="text" name="attr_halere" />
            </div>
        </div>
        <div class="flex-row">
             <span class="custom-label width-100px">Úroveň:</span><input type="text" name="attr_level" />
        </div>
        <div class="flex-row">
             <span class="custom-label">Volné zkušenosti:</span><input type="text" name="attr_free_experience" />
        </div>
        <div class="flex-column rit-item">
            <h3>Rituální předmět:</h3>
            <div>
                <div class="flex-row rit-item-charge">
                    <span class="custom-label">Nabití</span>
                    <input type="number" name="attr_rit-item" />
                    <span class="rit-item-charge__delimiter">/</span>
                    <input type="number" name="attr_rit-item_max" />
                </div>
            </div>
            <span class="custom-label">Popis</span>
            <textarea rows="4" name="attr_rit-item-desc"></textarea>
        </div>
<!--    </div>-->
</div>

<div class="special-abilities">
    <h1>Zvláštní schopnosti</h1>
    <div class="two-col">
        <fieldset class="repeating_specialabilities">
            <input type="text" name="attr_specialability" class="sheet-full-width sheet-two-col" />
        </fieldset>
    </div>
</div>

<div class="texts">
    <div class="two-col">
        <h1>Spisy</h1>
        <div class="texts-notes">
            <h3>Příběhové poznámky</h3>
            <textarea name="attr_notes"></textarea>
        </div>
        <div class="texts-story">
            <h3>Příběh hrdiny</h3>
            <textarea name="attr_story"></textarea>
        </div>
    </div>
</div>

<div class="companions">
    <div class="two-col">
        <h1>Pomocníci</h1>
    </div>
    <div class="two-col">
        <fieldset class="repeating_companions">
            <div class="flex-row">
                <label>Jméno:</label>&nbsp;<input type="text" name="attr_compname"/>
            </div>
            <div>
                <label>Sudba:&nbsp;<input type="number" name="attr_compresources"/></label>
            </div>
            <div>
                <label>Ohrožení:&nbsp;<input type="number" name="attr_compthreat"/></label>
            </div>
            <div>
                <label>Pouto:
                    <button type="action" name="aaa" class="custom-butt"><span name='aaa'></span></button>
                    <button type="action" name="bbb" class="custom-butt"><span name='bbb'></span></button>
                    <button type="action" name="ccc" class="custom-butt"><span name='ccc'></span></button>
                    <button type="action" name="ddd" class="custom-butt"><span name='ddd'></span></button>
                    <button type="action" name="eee" class="custom-butt"><span name='eee'></span></button>
                </label>
            </div>
            <div>
                <label>Charakteristika:&nbsp;<textarea name="attr_comprcharacteristic"></textarea></label>
            </div>
            <div>
                <label>Zvláštní schopnosti<textarea name="attr_comprspecialabilities"></textarea></label>
            </div>
            <div class="two-col">
                <label>Poznámky<textarea name="attr_comprnotes"></textarea></label>
                <hr class="companion-divider">
            </div>
        </fieldset>
    </div>
</div>
<div class="actionbar">
    <img src="https://raw.githubusercontent.com/samik027/Roll20-DRDII-character-sheet/5eefd9e80275896c8c4743672ddff384212d2b0b/actionbar.svg" />
</div>

<script type="text/worker">
    const buttonlist = ["character", "texts", "companions", "special-abilities"];
    buttonlist.forEach(button => {
        on(`clicked:${button}`, function () {
            setAttrs({
                sheetTab: button
            });
        });
    });
    let resourcebtns = [];
    for (let i = 0; i < 15; i++) {
        resourcebtns.push('resourcebody' + i);
        resourcebtns.push('resourcespirit' + i);
        resourcebtns.push('resourceinfluence' + i);
    }
    resourcebtns.forEach(button => {
        on(`clicked:${button}`, function () {
            getAttrs([button], function (v) {
                let val = Object.values(v)[0];
                let newVal = "/";
                if (val === '/') {
                    newVal = 'X';
                } else if (val === 'X') {
                    newVal = "|";
                } else if (val === '|') {
                    newVal = " ";
                }

                setAttrs({
                    [button]: newVal
                });
            });
        });
    });

    const btnLoad = ['load'];
    btnLoad.forEach(button => {
        on(`clicked:${button}`, function () {
            getAttrs([button], function (v) {
                let val = Object.values(v)[0];
                let newVal = "L";

                if (val === 'L') {
                    newVal = 'S';
                } else if (val === 'S') {
                    newVal = "T";
                }

                setAttrs({
                    [button]: newVal
                });
            });
        });
    });
</script>